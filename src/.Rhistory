dys.data <- select_outcome(data, "dyslipidemia", cov.indiv)
plot_bin_cont_relationship(dys.data, "dyslipidemia", "age")
test_age_disease_linearity("dyslipidemia", dys.data)
print("Quadratic relationship between age and dyslipidemia.")
dys.log.1 <- glm(dyslipidemia ~ age + sex + difficulties + education + swiss, data = dys.data, family = "binomial")
print_model_summary(dys.log.1)
dys.log.2 <- update(dys.log.1,  '~ . + I(age^2)')
print_model_summary(dys.log.2)
compare_models(dys.log.1, dys.log.2)
dys.data <- dys.data %>% mutate(dyslipidemia_adj = unname(resid(dys.log.2, type = "pearson")))
sink()
# MERGE & SAVE ------------------------------------------------------------
# Left join with dataset
adjusted_outcomes <- data %>% dplyr::select(-all_of(cov.indiv)) %>%
left_join(hyp.data %>% dplyr::select(pt, hypertension_adj), by='pt') %>%
left_join(obes.data %>% dplyr::select(pt, obesity_adj), by='pt') %>%
left_join(diab.data %>% dplyr::select(pt, diabetes_adj), by='pt') %>%
left_join(dys.data %>% dplyr::select(pt, dyslipidemia_adj), by='pt')
# threshold <- 4/length(diab.model$residuals)
# diab.data %>% filter(diabetes_cooks_dist > threshold)
# # Save potential outliers (influential observations) to file
# diab.outliers <- diab.data %>% filter(diabetes_cooks_dist > threshold)
# # inner_join(diab.outliers, outcomes %>% dplyr::select(pt, geometry), by="pt") %>% st_write("outliers.geojson")
# Save to file
st_write(adjusted_outcomes, paste0("../processed_data/f2_adjusted_outcomes_age_sex_cvd.gpkg"), driver='GPKG', delete_layer=TRUE)
DBI::dbDisconnect(con)
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
map_condition_number(hyp.data, "hypertension", hyp.tol, model="gwr")
map_condition_number(hyp.data, "hypertension", hyp.tol, model="mgwr")
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
map_condition_number(hyp.data, "hypertension", hyp.tol, model="gwr")
map_condition_number(hyp.data, "hypertension", hyp.tol, model="mgwr")
# map_association(hyp.data,"mgwr_MEDREV_TC", "hypertension", hyp.tol, model="GWR")
# map_coefficients(hyp.data,"mgwr_MEDREV_TC", "hypertension", hyp.tol, model="GWR")
# OBESITY -----------------------------------------------------------------
# Tolerance contours
obes.tol <- st_read("../results/spatial_disease_risk/obesity/f2/tolerance_contours_obesity_200_F2.geojson")
# GWR results
obes.data <- st_read("../results/regression_models/obesity/obesity_adj_spatreg_results.gpkg")
# Variables with significant associations
obes.interest <- c("intercept", "INTDEN", "GREEN_SP", "PM25", "NO2", "MEDREV", "R_UNEMP", "R_NN_POBL")
# Lot of variations between GWR and MGWR
create_maps_outcome(obes.data, obes.tol, obes.interest, "obesity")
map_condition_number(obes.data, "obesity", obes.tol, model="gwr")
map_condition_number(obes.data, "obesity", obes.tol, model="mgwr")
# DIABETES ----------------------------------------------------------------
# Tolerance contours
diab.tol <- st_read("../results/spatial_disease_risk/diabetes/f2/tolerance_contours_diabetes_200_F2.geojson")
# GWR results
diab.data <- st_read("../results/regression_models/diabetes/diabetes_adj_spatreg_results.gpkg")
# Variables with significant associations
diab.interest <- c("MEDREV", "R_NN_CH")
# Except for MEDREV that seem to act at a more local scale than what GWR was supposedly noticed, all variables act as global.
create_maps_outcome(diab.data, diab.tol, diab.interest, "diabetes")
map_condition_number(diab.data, "diabetes", diab.tol, model="gwr")
map_condition_number(diab.data, "diabetes", diab.tol, model="mgwr")
# DYSLIPIDEMIA ------------------------------------------------------------
# Tolerance contours
dys.tol <- st_read("../results/spatial_disease_risk/dyslipidemia/f2/tolerance_contours_dyslipidemia_200_F2.geojson")
# GWR results
dys.data <- st_read("../results/regression_models/dyslipidemia/dyslipidemia_adj_spatreg_results.gpkg")
map_condition_number(dys.data, "dyslipidemia", dys.tol, model="gwr")
map_condition_number(dys.data, "dyslipidemia", dys.tol, model="mgwr")
DBI::dbDisconnect(con)
require(tidyverse)
require(sf)
require(ggplot2)
require(viridis)
require(classInt)
require(ggspatial)
require(RPostgreSQL)
source('modeling/utils_map_gwr_results.R')
setwd("/mnt/data/GEOSAN/RESEARCH PROJECTS/GEOCHRONIC @ LASIG (EPFL)/GEOSAN-geochronic/src/")
# map_coefficients(hyp.data, paste0("gwr_PM25"), "hypertension", hyp.tol, type = "estimates", model="GWR")
# DBI::dbDisconnect(con)
create_maps_outcome <- function(data, tol_contours, vars_list, outcome){
for (var in vars_list) {
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "estimates", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "estimates", model="MGWR")
map_coefficients(data, paste0("gwr_", var), outcome, tol_contours, type = "t-values", model="GWR")
map_coefficients(data, paste0("mgwr_", var), outcome, tol_contours, type = "t-values", model="MGWR")
map_association(data, paste0("gwr_", var, "_TC"), outcome, tol_contours, model="GWR")
map_association(data, paste0("mgwr_", var, "_TC"), outcome, tol_contours, model="MGWR")
}
}
# tc_columns <- names(gwr)[grep("_TC$", names(gwr))]
# lapply(tc_columns, function(var) gwr_map(gwr, var))
# HYPERTENSION ------------------------------------------------------------
# Tolerance contours
hyp.tol <- st_read("../results/spatial_disease_risk/hypertension/f2/tolerance_contours_hypertension_200.geojson")
# GWR results
hyp.data <- st_read("../results/regression_models/hypertension/hypertension_adj_spatreg_results.gpkg")
# Variables with significant associations
hyp.interest <- c("PM25", "MEDREV")
# Few variations in bandwidths. It seems that all variables at a global level, and that GWR and MGWR do not show strong difference
create_maps_outcome(hyp.data, hyp.tol, hyp.interest, "hypertension")
map_condition_number(hyp.data, "hypertension", hyp.tol, model="gwr")
map_condition_number(hyp.data, "hypertension", hyp.tol, model="mgwr")
# map_association(hyp.data,"mgwr_MEDREV_TC", "hypertension", hyp.tol, model="GWR")
# map_coefficients(hyp.data,"mgwr_MEDREV_TC", "hypertension", hyp.tol, model="GWR")
# OBESITY -----------------------------------------------------------------
# Tolerance contours
obes.tol <- st_read("../results/spatial_disease_risk/obesity/f2/tolerance_contours_obesity_200_F2.geojson")
# GWR results
obes.data <- st_read("../results/regression_models/obesity/obesity_adj_spatreg_results.gpkg")
# Variables with significant associations
obes.interest <- c("intercept", "INTDEN", "GREEN_SP", "PM25", "NO2", "MEDREV", "R_UNEMP", "R_NN_POBL")
# Lot of variations between GWR and MGWR
create_maps_outcome(obes.data, obes.tol, obes.interest, "obesity")
map_condition_number(obes.data, "obesity", obes.tol, model="gwr")
map_condition_number(obes.data, "obesity", obes.tol, model="mgwr")
# DIABETES ----------------------------------------------------------------
# Tolerance contours
diab.tol <- st_read("../results/spatial_disease_risk/diabetes/f2/tolerance_contours_diabetes_200_F2.geojson")
# GWR results
diab.data <- st_read("../results/regression_models/diabetes/diabetes_adj_spatreg_results.gpkg")
# Variables with significant associations
diab.interest <- c("MEDREV", "R_NN_CH")
# Except for MEDREV that seem to act at a more local scale than what GWR was supposedly noticed, all variables act as global.
create_maps_outcome(diab.data, diab.tol, diab.interest, "diabetes")
map_condition_number(diab.data, "diabetes", diab.tol, model="gwr")
map_condition_number(diab.data, "diabetes", diab.tol, model="mgwr")
# DYSLIPIDEMIA ------------------------------------------------------------
# Tolerance contours
dys.tol <- st_read("../results/spatial_disease_risk/dyslipidemia/f2/tolerance_contours_dyslipidemia_200_F2.geojson")
# GWR results
dys.data <- st_read("../results/regression_models/dyslipidemia/dyslipidemia_adj_spatreg_results.gpkg")
map_condition_number(dys.data, "dyslipidemia", dys.tol, model="gwr")
map_condition_number(dys.data, "dyslipidemia", dys.tol, model="mgwr")
DBI::dbDisconnect(con)
